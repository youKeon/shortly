# Phase 1 í…ŒìŠ¤íŠ¸ ê²°ê³¼ (10K TPS ëª©í‘œ)

## í…ŒìŠ¤íŠ¸ í™˜ê²½
- **ì•„í‚¤í…ì²˜**: Spring Boot (Tomcat) + JPA (No Cache)
- **í…ŒìŠ¤íŠ¸ ë„êµ¬**: k6
- **ëª©í‘œ TPS**: 10,000+
- **ìµœëŒ€ VU**: 1,200
- **í…ŒìŠ¤íŠ¸ ì‹œê°„**: 3ë¶„

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼

| ì§€í‘œ | ê²°ê³¼ | ëª©í‘œ | ë‹¬ì„± ì—¬ë¶€ |
|------|------|------|-----------|
| **TPS** | **4,198** | 10,000+ | âŒ **42.0%** |
| **P95 ì‘ë‹µ ì‹œê°„** | **430.43ms** | <200ms | âŒ **215%** |
| **í‰ê·  ì‘ë‹µ ì‹œê°„** | **196.15ms** | - | - |
| **ì¤‘ê°„ê°’ ì‘ë‹µ ì‹œê°„** | **185.3ms** | - | - |
| **ì—ëŸ¬ìœ¨** | **0%** | <5% | âœ… |
| **ë¦¬ë””ë ‰ì…˜ ì„±ê³µë¥ ** | **100%** | >95% | âœ… |
| **ë‹¨ì¶• ì„±ê³µë¥ ** | **100%** | >95% | âœ… |
| **ì´ ìš”ì²­ ìˆ˜** | **757,539** | - | - |

---

## ì•„í‚¤í…ì²˜

```
Client Request
    â†“
Tomcat (Thread Pool: max 200)
    â†“
ShortUrlService (Blocking)
    â†“
MySQL DB (JPA) â† ëª¨ë“  ì¡°íšŒê°€ DB ì§í–‰
```

### ì£¼ìš” êµ¬ì„±
- **Web Server**: Tomcat (Thread-based, Blocking I/O)
- **Cache**: **ì—†ìŒ** âŒ
- **DB Connection Pool**: HikariCP (max: 20)

---

## ì„±ëŠ¥ ë¶„ì„

### ğŸ”´ ì‹¬ê°í•œ ë³‘ëª© ì§€ì 

#### 1. **ìºì‹œ ì™„ì „ ë¶€ì¬**
```java
// ëª¨ë“  ë¦¬ë‹¤ì´ë ‰ì…˜ ìš”ì²­ì´ DB ì§í–‰
ShortUrl shortUrl = shortUrlRepository.findByShortUrl(shortCode); // ~5-10ms
```

**ë¬¸ì œì :**
- 90% ë¦¬ë‹¤ì´ë ‰ì…˜ ìš”ì²­ì´ **ë§¤ë²ˆ DB ì¡°íšŒ**
- ë™ì¼í•œ shortCodeë¥¼ ë°˜ë³µ ì¡°íšŒí•´ë„ DB ì ‘ê·¼
- ìºì‹œ ì—†ì´ DBê°€ ëª¨ë“  ë¶€í•˜ í¡ìˆ˜

#### 2. **Tomcat ìŠ¤ë ˆë“œ í’€ í•œê³„**
```yaml
server:
  tomcat:
    threads:
      max: 200  # Phase 2ë³´ë‹¤ ì‘ìŒ (500)
```

**ë¬¸ì œì :**
- 1,200 VUë¥¼ 200 ìŠ¤ë ˆë“œë¡œ ì²˜ë¦¬
- ìŠ¤ë ˆë“œ ë¶€ì¡± ì‹œ íì‰ ì§€ì—° ì‹¬í™”
- Phase 2ë³´ë‹¤ ë” ì‘ì€ ìŠ¤ë ˆë“œ í’€

#### 3. **DB Connection Pool ë³‘ëª©**
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20  # ë§¤ìš° ì‘ìŒ
```

**ë¬¸ì œì :**
- 20ê°œ ì»¤ë„¥ì…˜ìœ¼ë¡œ ëª¨ë“  DB ìš”ì²­ ì²˜ë¦¬
- ì»¤ë„¥ì…˜ ëŒ€ê¸° ì‹œê°„ ë°œìƒ
- DBê°€ ë‹¨ì¼ ì¥ì• ì (SPOF)

---

### ğŸ“‰ ì™œ Phase 2ë³´ë‹¤ ë‚®ì€ê°€?

| í•­ëª© | Phase 1 (No Cache) | Phase 2 (Redis) | ì°¨ì´ |
|------|-------------------|-----------------|------|
| **TPS** | 4,198 | 4,587 | **-8.5%** âŒ |
| **P95** | 430.43ms | 425.18ms | **+1.2%** âŒ |
| **í‰ê· ** | 196.15ms | 179.5ms | **+9.3%** âŒ |

**ì›ì¸:**
1. **ëª¨ë“  ìš”ì²­ì´ DB ì¡°íšŒ** (Redis: ë„¤íŠ¸ì›Œí¬ 1-2ms vs DB: 5-10ms)
2. **DB Connection Pool í¬í™”** (20ê°œ â†’ ë¶€ì¡±)
3. **ì‘ì€ ìŠ¤ë ˆë“œ í’€** (200 vs 500)

---

## ìƒì„¸ ë©”íŠ¸ë¦­

### HTTP ìš”ì²­
```
ì´ ìš”ì²­ ìˆ˜:        757,539
TPS:              4,198/s
í‰ê·  ì‘ë‹µ ì‹œê°„:    196.15ms
ì¤‘ê°„ê°’:           185.3ms
P90:              362.84ms
P95:              430.43ms
ìµœëŒ€:             1.58s
```

### íŠ¸ë˜í”½ ë¶„í¬
```
ë¦¬ë””ë ‰ì…˜ ìš”ì²­:     681,837 (90%)
ë‹¨ì¶• ìš”ì²­:         75,502 (10%)
```

### ì„±ê³µë¥ 
```
ì „ì²´ ì„±ê³µë¥ :       100%
ë¦¬ë””ë ‰ì…˜ ì„±ê³µë¥ :   100%
ë‹¨ì¶• ì„±ê³µë¥ :       100%
ì—ëŸ¬ìœ¨:           0%
```

---

## ê°œì„  ë°©ì•ˆ

### 1ï¸âƒ£ **Redis ìºì‹œ ì¶”ê°€** (Phase 2)
```java
@Cacheable("shortUrls")
public String findOriginalUrl(String shortCode) {
    // Redis Hit: ~1-2ms
    // Redis Miss â†’ DB: ~5-10ms
}
```
**ì˜ˆìƒ íš¨ê³¼:**
- TPS: 4,198 â†’ **4,587** (+9.3%) âœ… ì‹¤ì¦
- í‰ê·  ì‘ë‹µ: 196ms â†’ **179ms** (-8.7%) âœ… ì‹¤ì¦

### 2ï¸âƒ£ **2-Level Cache** (Caffeine + Redis)
```java
// L1: Caffeine (ë¡œì»¬) - ì´ˆê³ ì†
// L2: Redis (ê¸€ë¡œë²Œ) - ì¼ê´€ì„±
```
**ì˜ˆìƒ íš¨ê³¼:**
- TPS: 4,198 â†’ **7,000+** (+67%)
- í‰ê·  ì‘ë‹µ: 196ms â†’ **<100ms** (-49%)

### 3ï¸âƒ£ **WebFlux + 2-Level Cache** (Phase 4)
**ì˜ˆìƒ íš¨ê³¼:**
- TPS: 4,198 â†’ **10,781** (+157%) ğŸš€
- í‰ê·  ì‘ë‹µ: 196ms â†’ **65.97ms** (-66%) ğŸš€

---

## ê²°ë¡ 

### âœ… ë‹¬ì„±í•œ ê²ƒ
- **ì™„ë²½í•œ ì•ˆì •ì„±** (ì—ëŸ¬ìœ¨ 0%, ì„±ê³µë¥  100%)
- ê¸°ë³¸ì ì¸ URL ë‹¨ì¶• ê¸°ëŠ¥ ë™ì‘
- 75ë§Œ ê±´ ìš”ì²­ ë¬´ê²°ì  ì²˜ë¦¬

### âŒ ì‹¬ê°í•œ ë¬¸ì œ
- **10K TPS ëª©í‘œì˜ 42%ë§Œ ë‹¬ì„±** (ìµœí•˜ìœ„)
- **ìºì‹œ ì—†ì–´ ëª¨ë“  ìš”ì²­ì´ DB ì§í–‰**
- DBê°€ ë‹¨ì¼ ì¥ì• ì (SPOF)
- ê°€ì¥ ëŠë¦° ì‘ë‹µ ì‹œê°„

### ğŸ’¡ í•µì‹¬ êµí›ˆ
**"ìºì‹œ ì—†ëŠ” ì•„í‚¤í…ì²˜ëŠ” ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì— ì ˆëŒ€ ë¶€ì í•©í•˜ë‹¤."**

```
Phase 1 (No Cache):     4,198 TPS âŒ (ìµœí•˜ìœ„)
Phase 2 (Redis):        4,587 TPS (9% ê°œì„ )
Phase 4 (WebFlux + 2-Level): 10,781 TPS (157% ê°œì„ ) âœ…
```

â†’ **ìºì‹± ì „ëµì´ ì„±ëŠ¥ì˜ í•µì‹¬!**

---

## í…ŒìŠ¤íŠ¸ ì¬í˜„

```bash
# 1. Phase 1 ë¸Œëœì¹˜ë¡œ ì´ë™
git checkout phase1

# 2. DB ì´ˆê¸°í™”
mysql -uroot -p<password> bitly -e "TRUNCATE TABLE urls; TRUNCATE TABLE url_clicks;"

# 3. ì„œë²„ ì‹œì‘ (ìºì‹œ ì„¤ì • ì—†ìŒ)
cd backend
DB_USERNAME=root DB_PASSWORD=<password> ./gradlew bootRun --args='--spring.profiles.active=phase1'

# 4. 10K TPS í…ŒìŠ¤íŠ¸ ì‹¤í–‰
cd ..
k6 run backend/performance-tests/target-10k-test.js
```

---

## Phase ê°„ ë¹„êµ (ìš”ì•½)

| Phase | ì•„í‚¤í…ì²˜ | TPS | ëª©í‘œ ë‹¬ì„±ë¥  |
|-------|---------|-----|------------|
| **Phase 1** | Tomcat (No Cache) | 4,198 | âŒ 42.0% |
| **Phase 2** | Tomcat + Redis | 4,587 | âŒ 45.9% |
| **Phase 4** | WebFlux + Caffeine + Redis | 10,781 | âœ… **107.8%** |

**ê²°ë¡ : ìºì‹±ê³¼ Reactive ì•„í‚¤í…ì²˜ê°€ í•„ìˆ˜!**
